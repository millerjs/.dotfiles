######################################################################
# File         ~/.tmux.conf
# Description  Personal tmux conf. Adds emacs keybindings, aesthetic
#                  changes and tpm plugins.
# Author       Josh Miller <jshuasmiller@gmail.com>
######################################################################

########################################
# General
########################################

set -g history-limit           10000
setw -g xterm-keys             on
setw -g aggressive-resize      on
set -g default-command """if uname -arv | grep -i darwin >/dev/null; then reattach-to-user-namespace -l bash; else bash; fi"""

########################################
# Aesthetics
########################################

# General
setw -g utf8                    on
set  -g status-utf8             on  # set utf-8 for the status bar
set  -g status                  on  # turn the status bar on
set  -g status-interval         5
set  -g clock-mode-style        12
set  -g default-terminal        "xterm-256color"

# Colors
set -g pane-active-border-bg    black
set -g pane-active-border-fg    colour21   # blue
set -g pane-border-fg           colour235  # dark gray
set -g status-bg                colour235  # dark gray
set -g status-fg                yellow     # yellow

# Status lines
set -g status-left "#[fg=green]:#h : #[fg=brightblue]#(ifconfig | grep 'inet' | grep -v 'inet6' | grep -v 127.0.0.1 | head -n1 | awk '{print $2}') #[fg=red]#(ifconfig tun0 | grep 'inet ' | awk '{print \"vpn \" $2}') : #[fg=green] [#{pane_width}x#{pane_height}] "
set -g status-right "#[fg=colour240]⦅ #(tmux list-sessions -F '#S' | tr '\n' ' ' | sed -e 's/[[:space:]]*$//' | sed 's/ / | /g' | sed \"s/`tmux display-message -p '#S'`/#[fg=brightblue]`tmux display-message -p '#S'`#[fg=colour240]/g\") ⦆ #{?pane_synchronized,#[bg=magenta]#[fg=yellow] ❮❮ SYNC ❯❯ #[bg=colour235],}#[fg=brightgreen] [ %m/%d ][ #{battery_percentage} ][ %l:%M ] #{?client_prefix,★ ,  } "

########################################
# Bindings
########################################

unbind C-o
set -g prefix                   C-o
bind C-o                        send-prefix
bind y                          set -g synchronize-panes

bind r source-file ~/.tmux.conf \; display "Reloaded config file"

########################################
# Arrangements
########################################

# Arrangement 1
#
#     +-----------+------------+
#     |           |            |
#     |           +------------+
#     |           |            |
#     |           +------------+
#     |           |            |
#     +-----------+------------+
#
bind 1 \
     split-window -h -p 44\;\
     resize-pane -t 0 -x 95\;\
     split-window -v -p 65\;\
     split-window -v -p 43\;\
     rotate-window -D \;\
     select-pane -U


########################################
# Panes
########################################

# Movement
bind C-b                        select-pane -L
bind C-f                        select-pane -R
bind C-p                        select-pane -U
bind C-n                        select-pane -D

# Rotation
bind C-r                        rotate-window -D
bind M-r                        rotate-window -U

# Splitting
bind v                          split-window -h
bind h                          split-window -v

########################################
# Sessions
########################################

bind w                          list-sessions

# switching
bind s command-prompt -p "session:" "switch-client -t %1"\; refresh-client -S
bind C-w                        switch-client -l\; refresh-client -S
bind C-q                        switch-client -p\; refresh-client -S
bind C-e                        switch-client -n\; refresh-client -S

########################################
# Mouse
########################################

setw -g                         mode-mouse on
set -g                          mouse-resize-pane off
set -g                          mouse-select-pane off
set -g                          mouse-select-window off

# set mouse on with prefix m
bind m \
    set -g mode-mouse on \;\
    set -g mouse-resize-pane on \;\
    set -g mouse-select-pane on \;\
    set -g mouse-select-window on \;\
    display 'Mouse:     ON'
# set mouse off with prefix M
bind M \
    set -g mode-mouse off \;\
    set -g mouse-resize-pane off \;\
    set -g mouse-select-pane off \;\
    set -g mouse-select-window off \;\
    display 'Mouse:     OFF'

########################################
# Zoom
########################################

# Zoom in
unbind                          [
unbind                          ]
bind                            C-[ \
    new-window -d -n tmux-zoom 'clear && echo TMUX ZOOM && read' \;\
    swap-pane -s tmux-zoom.0 \;\
    select-window -t tmux-zoom

# Zoom out
bind                            C-] \
    last-window \;\
    swap-pane -s tmux-zoom.0 \;\
    kill-window -t tmux-zoom

########################################
# Plugins
########################################

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
run '~/.tmux/plugins/tpm/tpm'
